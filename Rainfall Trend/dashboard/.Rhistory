##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/PRCPTOT_1951"
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
# Extract month number from file names
months <- as.numeric(gsub(".*_(\\d+)\\.tif$", "\\1", basename(tif.files)))
month
tif.files
# Order files by month number
tif.files <- tif.files[order(months)]
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters
##set the grid size as 4 rows and 3 columns
par(mfrow=c(4,3))
month_names=month.abb
for (month in 1:12) {
plot(rasters[[month]], main = paste("PRCPTOT 1951 -", month_names[month]))
}
runApp()
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/CDD_1951"
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
tif.files
# Extract month number from file names
months <- as.numeric(gsub(".*_(\\d+)\\.tif$", "\\1", basename(tif.files)))
# Order files by month number
tif.files <- tif.files[order(months)]
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters<-rast(rasters)
rasters
runApp()
rasters
pts_raster<-as.points(rasters,values=TRUE)
df<-as.data.frame(pts_raster)
df
rasters
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
# Extract month number from file names
months <- as.numeric(gsub(".*_(\\d+)\\.tif$", "\\1", basename(tif.files)))
# Order files by month number
tif.files <- tif.files[order(months)]
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters
rasters<-rast(rasters)
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/Rx1day_1951/"
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
# Extract month number from file names
months <- as.numeric(gsub(".*_(\\d+)\\.tif$", "\\1", basename(tif.files)))
# Order files by month number
tif.files <- tif.files[order(months)]
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters
rasters<-rast(rasters)
library(terra)
library(viridis)
rasters[[1]]
##Convert raster to points(for interactive hover)
pts_raster<-as.points(rasters[[1]],values=TRUE)
df<-as.data.frame(pts_raster)
df
names(df)[1:3]<-c("lon","lat","rain")
##Convert raster to points(for interactive hover)
pts_raster<-as.points(rasters[[1]],values=TRUE)
df<-as.data.frame(pts_raster,xy=TRUE)
df
##Convert raster to points(for interactive hover)
pts_raster<-as.points(rasters,values=TRUE)
df<-as.data.frame(pts_raster,xy=TRUE)
df
runApp()
source("C:/Hydrology-Project/Rainfall Trend/dashboard/app.R")
source("C:/Hydrology-Project/Rainfall Trend/dashboard/app.R")
runApp()
runApp()
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##import required libraries
library(terra)
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/CDD_1951"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
r
dates
points<-read.csv(url_1) ##read csv file
points
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
pts
r
# Define threshold for dry day
dry_threshold <- 10  # mm
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
rain_values
##Remove ID column
rain_values<-rain_values[,-1]
rain_values
##Rnnmm indices
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/CDD_1951"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
# Define threshold for dry day
dry_threshold <- 10  # mm
##define end date and start date for each month
monthly_index<-which(format(dates,"%m")==sprintf("%02d",1))
monthly_index
##define end date and start date for each month
monthly_index<-which(format(dates,"%m")==sprintf("%02d",2))
monthly_index
##define end date and start date for each month
monthly_index<-which(format(dates,"%m")==sprintf("%02d",1))
monthly_index
##Daily precipitation data for each month
monthly_precipitation<-r[[monthly_index]]
monthly_precipitation
##define end date and start date for each month
monthly_index<-which(format(dates,"%m")==sprintf("%02d",2))
monthly_index
##Daily precipitation data for each month
monthly_precipitation<-r[[monthly_index]]
monthly_precipitation
##define end date and start date for each month
monthly_index<-which(format(dates,"%m")==sprintf("%02d",3))
monthly_index
##Daily precipitation data for each month
monthly_precipitation<-r[[monthly_index]]
monthly_precipitation
##define end date and start date for each month
monthly_index<-which(format(dates,"%m")==sprintf("%02d",1))
monthly_index
##Daily precipitation data for each month
monthly_precipitation<-r[[monthly_index]]
monthly_precipitation
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
vals
vals_mat<-as.matrix(vals[,-1,drop=FALSE]) ##remove ID column
vals_mat
Rnnmm<-function(daily_precip,threshold){
no_days<-sum(daily_precip>threshold)
return(no_days)
}
days<-apply(vals_mat,1,Rnnmm,threshold=dry_threshold)
days
length(days)
##Attach the result as points
pts$Rnnmm<-monthly_days
monthly_days<-apply(vals_mat,1,Rnnmm,threshold=dry_threshold)
##Attach the result as points
pts$Rnnmm<-monthly_days
##create the raster layers
templete<-monthly_precipitation[[1]]
Rxdday_raster<-rasterize(pts,templete,field="Rnnmm")
##Save raster
file_name<-paste0(save_url,"R",dry_threshold,"mm_1951_",sprintf("%02d",month),".tif")
##Rnnmm indices
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/Rnnmm/"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
# Define threshold for dry day
dry_threshold <- 10  # mm
##define end date and start date for each month
monthly_index<-which(format(dates,"%m")==sprintf("%02d",1))
monthly_index
##Daily precipitation data for each month
monthly_precipitation<-r[[monthly_index]]
monthly_precipitation
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
vals_mat<-as.matrix(vals[,-1,drop=FALSE]) ##remove ID column
vals_mat
Rnnmm<-function(daily_precip,threshold){
no_days<-sum(daily_precip>threshold)
return(no_days)
}
monthly_days<-apply(vals_mat,1,Rnnmm,threshold=dry_threshold)
##Attach the result as points
pts$Rnnmm<-monthly_days
##create the raster layers
templete<-monthly_precipitation[[1]]
Rnnmm_raster<-rasterize(pts,templete,field="Rnnmm")
##Save raster
file_name<-paste0(save_url,"R",dry_threshold,"mm_1951_",sprintf("%02d",month),".tif")
writeRaster(Rnnmm_raster,file_name,overwrite=TRUE)
##Rnnmm indices
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/Rnnmm/"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
# Define threshold for dry day
dry_threshold <- 10  # mm
##define end date and start date for each month
monthly_index<-which(format(dates,"%m")==sprintf("%02d",1))
monthly_index
##Daily precipitation data for each month
monthly_precipitation<-r[[monthly_index]]
monthly_precipitation
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
vals_mat<-as.matrix(vals[,-1,drop=FALSE]) ##remove ID column
vals_mat
Rnnmm<-function(daily_precip,threshold){
no_days<-sum(daily_precip>threshold)
return(no_days)
}
monthly_days<-apply(vals_mat,1,Rnnmm,threshold=dry_threshold)
##Attach the result as points
pts$Rnnmm<-monthly_days
##create the raster layers
templete<-monthly_precipitation[[1]]
Rnnmm_raster<-rasterize(pts,templete,field="Rnnmm")
##Save raster
file_name<-paste0(save_url,"R",dry_threshold,"mm_1951_",sprintf("%02d",1),".tif")
writeRaster(Rnnmm_raster,file_name,overwrite=TRUE)
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
tif.files
# Extract month number from file names
months <- as.numeric(gsub(".*_(\\d+)\\.tif$", "\\1", basename(tif.files)))
months
# Order files by month number
tif.files <- tif.files[order(months)]
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters
library(terra)
library(viridis)
val_range <- range(values(rasters), na.rm = TRUE)
val_range <- range(values(rasters), na.rm = TRUE)
rasters
par(mfrow = c(4, 3),
mar = c(2, 2, 3, 2),
oma = c(0, 0, 4, 0))
month_names <- month.abb
month_names
plot(rasters[[i]], col = viridis(30), zlim = val_range,
main = paste0("R",dry_threshold,"mm-(1951)"," -", month_names[1]),
axes = FALSE, box = FALSE)
plot(rasters, col = viridis(30), zlim = val_range,
main = paste0("R",dry_threshold,"mm-(1951)"," -", month_names[1]),
axes = FALSE, box = FALSE)
class(rasters)
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
# Extract month number from file names
months <- as.numeric(gsub(".*_(\\d+)\\.tif$", "\\1", basename(tif.files)))
# Order files by month number
tif.files <- tif.files[order(months)]
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters
rasters<-rast(rasters)
class(rasters)
library(terra)
library(viridis)
val_range <- range(values(rasters), na.rm = TRUE)
par(mfrow = c(4, 3),
mar = c(2, 2, 3, 2),
oma = c(0, 0, 4, 0))
month_names <- month.abb
plot(rasters, col = viridis(30), zlim = val_range,
main = paste0("R",dry_threshold,"mm-(1951)"," -", month_names[1]),
axes = FALSE, box = FALSE)
plot(rasters, col = viridis(30), zlim = val_range,
main = paste0("R",dry_threshold,"mm-(1951)"," -", month_names[1]),
axes = FALSE, box = FALSE)
mtext("Monthly Rnnmm — Year 1951",
outer = TRUE, cex = 1.5, font = 2)
##Rnnmm indices
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/Rnnmm/"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
# Define threshold for dry day
dry_threshold <- 10  # mm
##define the user define function for climate indics Rnnmm
Rnnmm<-function(daily_precip,threshold){
no_days<-sum(daily_precip>threshold)
return(no_days)
}
##loo[ through all the months Jan-Dec]
for (month in 1:12) {
##define end date and start date for each month
monthly_index<-which(format(dates,"%m")==sprintf("%02d",month))
##Daily precipitation data for each month
monthly_precipitation<-r[[monthly_index]]
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
vals_mat<-as.matrix(vals[,-1,drop=FALSE]) ##remove ID column
monthly_days<-apply(vals_mat,1,Rnnmm,threshold=dry_threshold)
##Attach the result as points
pts$Rnnmm<-monthly_days
##create the raster layers
templete<-monthly_precipitation[[1]]
Rnnmm_raster<-rasterize(pts,templete,field="Rnnmm")
##Save raster
file_name<-paste0(save_url,"R",dry_threshold,"mm_1951_",sprintf("%02d",month),".tif")
writeRaster(Rnnmm_raster,file_name,overwrite=TRUE)
}
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
tif.files
# Extract month number from file names
months <- as.numeric(gsub(".*_(\\d+)\\.tif$", "\\1", basename(tif.files)))
# Order files by month number
tif.files <- tif.files[order(months)]
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters
rasters<-rast(rasters)
library(terra)
library(viridis)
val_range <- range(values(rasters), na.rm = TRUE)
par(mfrow = c(4, 3),
mar = c(2, 2, 3, 2),
oma = c(0, 0, 4, 0))
month_names <- month.abb
for (i in 1:12) {
plot(rasters[[i]], col = viridis(30), zlim = val_range,
main = paste("Rx1day (1951) -", month_names[i]),
axes = FALSE, box = FALSE)
}
mtext("Monthly Maximum 1-Day Rainfall (Rx1day) — Year 1951",
outer = TRUE, cex = 1.5, font = 2)
for (i in 1:12) {
plot(rasters[[i]], col = viridis(30), zlim = val_range,
main = paste0("R",dry_threshold,"mm(1951)-", month_names[i]),
axes = FALSE, box = FALSE)
}
mtext(paste0("Monthly R",dry_threshold,"nn— Year 1951",
outer = TRUE, cex = 1.5, font = 2))
for (i in 1:12) {
plot(rasters[[i]], col = viridis(30), zlim = val_range,
main = paste0("R",dry_threshold,"mm(1951)-", month_names[i]),
axes = FALSE, box = FALSE)
}
mtext("Monthly R",dry_threshold,"nn— Year 1951",
outer = TRUE, cex = 1.5, font = 2)
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
dates
r
monthly_index<-which(format(dates,"%m")==sprintf("%02d",1))
monthly_precipitation<-r[[monthly_index]]
monthly_precipitation
values(monthly_precipitation)
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
pts
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
vals
View(vals)
class(vals)
vals[1,]
vals[-1,]
vals[,-1]
vals<-vals[1,]
vals
vals<-vals[-1,]
vals
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
va<-vals[-1,]
va
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
monthly_index<-which(format(dates,"%m")==sprintf("%02d",1))
monthly_precipitation<-r[[monthly_index]]
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
vals
boxplot(vals[1,])
boxplot(vals[1,])
vals[1,]
l<-list(vals[1,])
l
vals_long <- melt(vals, id.vars="ID", variable.name="day", value.name="precipitation")
# Convert 'day' to actual Date
vals_long$day <- as.numeric(gsub("X", "", vals_long$day))  # remove 'X' from column names
vals_long
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
vals
vals_long <- melt(vals, id.vars="ID", variable.name="day", value.name="precipitation")
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
monthly_index<-which(format(dates,"%m")==sprintf("%02d",1))
monthly_precipitation<-r[[monthly_index]]
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
vals
vals_long <- melt(vals, id.vars="ID", variable.name="day", value.name="precipitation")
# Convert 'day' to actual Date
vals_long$day <- as.numeric(gsub("X", "", vals_long$day))  # remove 'X' from column names
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
monthly_index<-which(format(dates,"%m")==sprintf("%02d",1))
monthly_precipitation<-r[[monthly_index]]
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
vals
str(vals)
install.packages("reshape2")
library(reshape2)
# Make sure column names are numeric (day indices)
day_cols <- setdiff(names(vals), "ID")  # all columns except ID
vals_long <- melt(vals, id.vars="ID", measure.vars=day_cols,
variable.name="day", value.name="precipitation")
# Convert 'day' to numeric
vals_long$day <- as.numeric(as.character(vals_long$day))
# Create proper dates
vals_long$date <- as.Date(vals_long$day - 1, origin="1951-01-01")
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
# Get all columns except ID
day_cols <- setdiff(names(vals), "ID")
# Extract the numeric part of column names
day_nums <- as.numeric(gsub("[^0-9]", "", day_cols))  # removes everything except digits
vals_long <- melt(vals, id.vars="ID", measure.vars=day_cols,
variable.name="day", value.name="precipitation")
# Assign the correct numeric day
vals_long$day <- rep(day_nums, each = nrow(vals))
# Create proper dates for January
vals_long$date <- as.Date(vals_long$day - 1, origin="1951-01-01")
vals_long
library(ggplot2)
# Boxplot per location
ggplot(vals_long, aes(x=factor(ID), y=precipitation)) +
geom_boxplot(fill="lightblue") +
labs(x="Location ID", y="Daily Precipitation (mm)", title="January Daily Precipitation") +
theme_minimal()
# Time series per location
ggplot(vals_long, aes(x=date, y=precipitation, color=factor(ID))) +
geom_line() +
geom_point() +
labs(x="Date", y="Daily Precipitation (mm)", title="January Daily Precipitation Time Series") +
theme_minimal()
