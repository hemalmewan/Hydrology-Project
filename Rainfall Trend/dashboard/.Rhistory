l<-list(vals[1,])
l
vals_long <- melt(vals, id.vars="ID", variable.name="day", value.name="precipitation")
# Convert 'day' to actual Date
vals_long$day <- as.numeric(gsub("X", "", vals_long$day))  # remove 'X' from column names
vals_long
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
vals
vals_long <- melt(vals, id.vars="ID", variable.name="day", value.name="precipitation")
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
monthly_index<-which(format(dates,"%m")==sprintf("%02d",1))
monthly_precipitation<-r[[monthly_index]]
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
vals
vals_long <- melt(vals, id.vars="ID", variable.name="day", value.name="precipitation")
# Convert 'day' to actual Date
vals_long$day <- as.numeric(gsub("X", "", vals_long$day))  # remove 'X' from column names
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
monthly_index<-which(format(dates,"%m")==sprintf("%02d",1))
monthly_precipitation<-r[[monthly_index]]
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
vals
str(vals)
install.packages("reshape2")
library(reshape2)
# Make sure column names are numeric (day indices)
day_cols <- setdiff(names(vals), "ID")  # all columns except ID
vals_long <- melt(vals, id.vars="ID", measure.vars=day_cols,
variable.name="day", value.name="precipitation")
# Convert 'day' to numeric
vals_long$day <- as.numeric(as.character(vals_long$day))
# Create proper dates
vals_long$date <- as.Date(vals_long$day - 1, origin="1951-01-01")
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
# Get all columns except ID
day_cols <- setdiff(names(vals), "ID")
# Extract the numeric part of column names
day_nums <- as.numeric(gsub("[^0-9]", "", day_cols))  # removes everything except digits
vals_long <- melt(vals, id.vars="ID", measure.vars=day_cols,
variable.name="day", value.name="precipitation")
# Assign the correct numeric day
vals_long$day <- rep(day_nums, each = nrow(vals))
# Create proper dates for January
vals_long$date <- as.Date(vals_long$day - 1, origin="1951-01-01")
vals_long
library(ggplot2)
# Boxplot per location
ggplot(vals_long, aes(x=factor(ID), y=precipitation)) +
geom_boxplot(fill="lightblue") +
labs(x="Location ID", y="Daily Precipitation (mm)", title="January Daily Precipitation") +
theme_minimal()
# Time series per location
ggplot(vals_long, aes(x=date, y=precipitation, color=factor(ID))) +
geom_line() +
geom_point() +
labs(x="Date", y="Daily Precipitation (mm)", title="January Daily Precipitation Time Series") +
theme_minimal()
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/CWD_1951"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
# Define threshold for dry day
dry_threshold <- 1  # mm
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
rain_values
values(r)
rain_values
##define the customize function
CDD<-function(daily_precip,threshold){
dry<-as.numeric(daily_precip)>=threshold
if(all(!dry)) return(0) ##no wet days all are dry days
rle_dry<-rle(dry)
max_cdd<-max(rle_dry$lengths[rle_dry$values])
return(max_cdd)
}
##Apply above function for each station
cdd_values<-apply(rain_values,1,CDD,threshold=dry_threshold)
cdd_values
length(cdd_values)
pts$CDD<-cdd_values
##CWD indices
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/CWD_1951"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
# Define threshold for wet day
wet_threshold <- 1  # mm
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
##define the customize function
CWD<-function(daily_precip,threshold){
dry<-as.numeric(daily_precip)>=threshold
if(all(!dry)) return(0) ##no wet days all are dry days
rle_dry<-rle(dry)
max_cdd<-max(rle_dry$lengths[rle_dry$values])
return(max_cdd)
}
##Apply above function for each station
cwd_values<-apply(rain_values,1,CWD,threshold=wet_threshold)
pts$CWD<-cwd_values
##rasterize output
CWD_raster<-rasterize(pts,r[[1]],field="CWD")
## Save raster
file_name <- paste0(save_url, "CWD_1951.tif")
writeRaster(CWD_raster, file_name, overwrite = TRUE)
cat("Saved:", file_name, "\n")
##CWD indices
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/CWD_1951/"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
# Define threshold for wet day
wet_threshold <- 1  # mm
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
##define the customize function
CWD<-function(daily_precip,threshold){
dry<-as.numeric(daily_precip)>=threshold
if(all(!dry)) return(0) ##no wet days all are dry days
rle_dry<-rle(dry)
max_cdd<-max(rle_dry$lengths[rle_dry$values])
return(max_cdd)
}
##Apply above function for each station
cwd_values<-apply(rain_values,1,CWD,threshold=wet_threshold)
pts$CWD<-cwd_values
##rasterize output
CWD_raster<-rasterize(pts,r[[1]],field="CWD")
## Save raster
file_name <- paste0(save_url, "CWD_1951.tif")
writeRaster(CWD_raster, file_name, overwrite = TRUE)
cat("Saved:", file_name, "\n")
##CWD indices
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/CWD_1951/"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
# Define threshold for wet day
wet_threshold <- 1  # mm
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
##define the customize function
CWD<-function(daily_precip,threshold){
wet<-as.numeric(daily_precip)>=threshold
if(all(!wet)) return(0) ##no wet days all are dry days
rle_wet<-rle(wet)
max_cwd<-max(rle_wet$lengths[rle_wet$values])
return(max_cwd)
}
##Apply above function for each station
cwd_values<-apply(rain_values,1,CWD,threshold=wet_threshold)
pts$CWD<-cwd_values
##rasterize output
CWD_raster<-rasterize(pts,r[[1]],field="CWD")
CWD_raster
## Save raster
file_name <- paste0(save_url, "CWD_1951.tif")
writeRaster(CWD_raster, file_name, overwrite = TRUE)
cat("Saved:", file_name, "\n")
##plot raster file
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
tif.files
# Extract month number from file names
months <- as.numeric(gsub(".*_(\\d+)\\.tif$", "\\1", basename(tif.files)))
months
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters<-rast(rasters)
rasters
# Plot with scientific color scale
plot(rasters,
main = "Consecutive Wet Days (WET) – 1951",
col = hcl.colors(30, "YlOrRd"))
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/CDD_1951"
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
tif.files
# Extract month number from file names
months <- as.numeric(gsub(".*_(\\d+)\\.tif$", "\\1", basename(tif.files)))
# Order files by month number
tif.files <- tif.files[order(months)]
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters<-rast(rasters)
rasters
# Plot with scientific color scale
plot(rasters,
main = "Consecutive Dry Days (CDD) – 1951",
col = hcl.colors(30, "YlOrRd"))
# List all daily raster files
files <- list.files("C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_1", pattern = "\\.tif$", full.names = TRUE)
files
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
r<-rast(url)
r
r[[1]]
precip<-values(r[[1]])
precip
precip<-na.omit(precip)
precip
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
r<-rast(url)
precip<-values(r[[1]])
precip<-precip[na.omit(precip)]
precip
precip<-precip[!na.omit(precip)]
precip
r<-rast(url)
precip<-values(r[[1]])
r[[1]]
precip<-values(r[[1]])
precip
# Read the CSV file
data <- read.csv("C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv")
# Ensure the CSV has columns: longitude, latitude, and value
head(data)
# Create a raster from the CSV data
raster_data <- rasterFromXYZ(data)
# Read data
rain <- read.csv("C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv")
library(terra)
# Read data
rain <- read.csv("C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv")
# Extract coordinates
coords <- rain[, c("lon", "lat")]
coords
names(rain)[4]
rain[[4]]
library(terra)
# Read data
rain <- read.csv("C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv")
# Extract coordinates
coords <- rain[, c("lon", "lat")]
# Loop through each day (starting from 3rd column)
for (i in 4:ncol(rain)) {
day_col <- names(rain)[i]
rainfall_day <- rain[[i]]
# Create spatial points
pts <- vect(data.frame(coords, rainfall = rainfall_day), geom = c("lon", "lat"), crs = "EPSG:4326")
# Create a raster grid
r_template <- rast(ext(pts), resolution =1)  # adjust resolution if needed
crs(r_template) <- "EPSG:4326"
# Rasterize rainfall
r_rain <- rasterize(pts, r_template, field = "rainfall", fun = mean)
# Save raster
filename <- paste0("C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_tif/rainfall_1951_day_", i - 3, ".tif")
writeRaster(r_rain, filename, overwrite = TRUE)
cat("Saved:", filename, "\n")
}
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_tif/rainfall_1951_day_1"
r<-rast(url)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_tif/rainfall_1951_day_1.tif"
r<-rast(url)
r
precip<-values(r)
precip
str(rain)
precip
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_tif/rainfall_1951_day_1.tif"
r<-rast(url)
r
# Plot with scientific color scale
plot(r,
main = "Consecutive Dry Days (CDD) – 1951",
col = hcl.colors(30, "YlOrRd"))
precip<-values(r)
precip
r
library(terra)
# List all daily raster files
files <- list.files("C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_tif/rainfall_1951_day_tif", pattern = "\\.tif$", full.names = TRUE)
files
# List all daily raster files
files <- list.files("C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_tif", pattern = "\\.tif$", full.names = TRUE)
files
# Extract numeric day index from filenames
day_numbers <- as.numeric(gsub(".*day_([0-9]+)\\.tif$", "\\1", basename(files)))
day_numbers
# Order files numerically
files <- files[order(day_numbers)]
# Read them as a SpatRaster stack (one layer per day)
r_stack <- rast(files)
r_stack
##assign actual dates
dates <- seq(as.Date("1951-01-01"), as.Date("1951-12-31"), by = "day")
time(r_stack) <- dates
dates
# Write to NetCDF
writeCDF(r_stack,
filename = "C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1952_daily.nc",
overwrite = TRUE,
varname = "precip",
unit = "mm/day",
longname = "Daily precipitation",
compression = 4)
install.packages("ncdf4")
# Write to NetCDF
writeCDF(r_stack,
filename = "C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1952_daily.nc",
overwrite = TRUE,
varname = "precip",
unit = "mm/day",
longname = "Daily precipitation",
compression = 4)
cat("NetCDF file created successfully!\n")
library(terra)
# Read data
rain <- read.csv("C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv")
# Extract coordinates
coords <- rain[, c("lon", "lat")]
# Loop through each day (starting from 3rd column)
for (i in 4:ncol(rain)) {
day_col <- names(rain)[i]
rainfall_day <- rain[[i]]
# Create spatial points
pts <- vect(data.frame(coords, rainfall = rainfall_day), geom = c("lon", "lat"), crs = "EPSG:4326")
# Create a raster grid
r_template <- rast(ext(pts), resolution =0.25)  # adjust resolution if needed
crs(r_template) <- "EPSG:4326"
# Rasterize rainfall
r_rain <- rasterize(pts, r_template, field = "rainfall", fun = mean)
# Save raster
filename <- paste0("C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_tif/rainfall_1951_day_", i - 3, ".tif")
writeRaster(r_rain, filename, overwrite = TRUE)
cat("Saved:", filename, "\n")
}
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_tif/rainfall_1951_day_1.tif"
r<-rast(url)
precip<-values(r)
precip
r
# Plot with scientific color scale
plot(r,
main = "Consecutive Dry Days (CDD) – 1951",
col = hcl.colors(30, "YlOrRd"))
# List all daily raster files
files <- list.files("C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_tif", pattern = "\\.tif$", full.names = TRUE)
files
# Extract numeric day index from filenames
day_numbers <- as.numeric(gsub(".*day_([0-9]+)\\.tif$", "\\1", basename(files)))
# Order files numerically
files <- files[order(day_numbers)]
files
# Read them as a SpatRaster stack (one layer per day)
r_stack <- rast(files)
##assign actual dates
dates <- seq(as.Date("1951-01-01"), as.Date("1951-12-31"), by = "day")
time(r_stack) <- dates
dates
# Write to NetCDF
writeCDF(r_stack,
filename = "C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1952_daily.nc",
overwrite = TRUE,
varname = "precip",
unit = "mm/day",
longname = "Daily precipitation",
compression = 4)
cat("NetCDF file created successfully!\n")
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/PRCPTOT_1951"
points<-read.csv(url_1) ##read csv file
str(points)
r<-rast(url) ##convert raster object
# List all daily raster files
files <- list.files("C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_tif", pattern = "\\.tif$", full.names = TRUE)
files
library(terra)
# List all daily raster files
files <- list.files("C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_tif", pattern = "\\.tif$", full.names = TRUE)
# Extract numeric day index from filenames
day_numbers <- as.numeric(gsub(".*day_([0-9]+)\\.tif$", "\\1", basename(files)))
# Order files numerically
files <- files[order(day_numbers)]
# Read them as a SpatRaster stack (one layer per day)
r_stack <- rast(files)
##assign actual dates
dates <- seq(as.Date("1951-01-01"), as.Date("1951-12-31"), by = "day")
time(r_stack) <- dates
# Write to NetCDF
writeCDF(r_stack,
filename = "C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc",
overwrite = TRUE,
varname = "precip",
unit = "mm/day",
longname = "Daily precipitation",
compression = 4)
cat("NetCDF file created successfully!\n")
##import required libraries
library(terra)
library(zoo)
##define threshold value
threshold<-1
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/PRCPTOT_1951"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
r
library(terra)
# List all daily raster files
files <- list.files("C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_tif", pattern = "\\.tif$", full.names = TRUE)
# Extract numeric day index from filenames
day_numbers <- as.numeric(gsub(".*day_([0-9]+)\\.tif$", "\\1", basename(files)))
# Order files numerically
files <- files[order(day_numbers)]
# Read them as a SpatRaster stack (one layer per day)
r_stack <- rast(files)
##assign actual dates
dates <- seq(as.Date("1951-01-01"), as.Date("1951-12-31"), by = "day")
time(r_stack) <- dates
library(terra)
# List all daily raster files
files <- list.files("C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_tif", pattern = "\\.tif$", full.names = TRUE)
# Extract numeric day index from filenames
day_numbers <- as.numeric(gsub(".*day_([0-9]+)\\.tif$", "\\1", basename(files)))
# Order files numerically
files <- files[order(day_numbers)]
# Read them as a SpatRaster stack (one layer per day)
r_stack <- rast(files)
##assign actual dates
dates <- seq(as.Date("1951-01-01"), as.Date("1951-12-31"), by = "day")
time(r_stack) <- dates
library(terra)
# List all daily raster files
files <- list.files("C:/Hydrology-Project/Rainfall Trend/yearly-rasters/rainfall_1951_day_tif", pattern = "\\.tif$", full.names = TRUE)
# Extract numeric day index from filenames
day_numbers <- as.numeric(gsub(".*day_([0-9]+)\\.tif$", "\\1", basename(files)))
# Order files numerically
files <- files[order(day_numbers)]
# Read them as a SpatRaster stack (one layer per day)
r_stack <- rast(files)
##assign actual dates
dates <- seq(as.Date("1951-01-01"), as.Date("1951-12-31"), by = "day")
time(r_stack) <- dates
dates
time(r_stack) <- dates
