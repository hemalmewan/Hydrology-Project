dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
##define the customize function
R95<-function(daily_precip,threshold){
wet<-sum(daily_precip[as.numeric(daily_precip)>threshold])
return(wet)
}
##Apply above function for each station
very_wet-days<-apply(rain_values,1,CWD,threshold=p95)
##read the 95th percentile value in the file
p95 <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/p95_threshold.rds")
print(p95)  # check value
##read the 95th percentile value in the file
p95 <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/p95_threshold.rds")
print(p95)  # check value
##R95  indices
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/R95/"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
##define the customize function
R95<-function(daily_precip,threshold){
wet<-sum(daily_precip[as.numeric(daily_precip)>threshold])
return(wet)
}
##Apply above function for each station
very_wet_days<-apply(rain_values,1,CWD,threshold=p95)
very_wet_days
##read the 95th percentile value in the file
p95 <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/p95_threshold.rds")
print(p95)  # check value
##R95  indices
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/R95/"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
##define the customize function
R95<-function(daily_precip,threshold){
wet<-sum(daily_precip[as.numeric(daily_precip)>threshold])
return(wet)
}
##Apply above function for each station
very_wet_days<-apply(rain_values,1,R95,threshold=p95)
very_wet_days
length(very_wet_days)
##read the 95th percentile value in the file
p95 <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/p95_threshold.rds")
print(p95)  # check value
##read the 95th percentile value in the file
p95 <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/p95_threshold.rds")
print(p95)  # check value
##R95  indices
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/R95/"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
##define the customize function
R95p<-function(daily_precip,threshold){
wet<-sum(daily_precip[as.numeric(daily_precip)>threshold])
return(wet)
}
##Apply above function for each station
very_wet_days<-apply(rain_values,1,R95,threshold=p95)
pts$R95p<-cwd_values
##rasterize output
CWD_raster<-rasterize(pts,r[[1]],field="R95p")
## Save raster
file_name <- paste0(save_url, "R95p_1951.tif")
writeRaster(CWD_raster, file_name, overwrite = TRUE)
cat("Saved:", file_name, "\n")
##plot raster file
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
tif.files
# Extract month number from file names
months <- as.numeric(gsub(".*_(\\d+)\\.tif$", "\\1", basename(tif.files)))
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters
rasters<-rast(rasters)
rasters
##read the 95th percentile value in the file
p95 <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/p95_threshold.rds")
print(p95)  # check value
##R95  indices
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/R95/"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
##define the customize function
R95p<-function(daily_precip,threshold){
wet<-sum(daily_precip[as.numeric(daily_precip)>threshold])
return(wet)
}
##Apply above function for each station
very_wet_days<-apply(rain_values,1,R95,threshold=p95)
pts$R95p<-very_wet_days
##rasterize output
CWD_raster<-rasterize(pts,r[[1]],field="R95p")
## Save raster
file_name <- paste0(save_url, "R95p_1951.tif")
writeRaster(CWD_raster, file_name, overwrite = TRUE)
cat("Saved:", file_name, "\n")
##plot raster file
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters<-rast(rasters)
rasters
# Plot with scientific color scale
plot(rasters,
main = "R95p for 1951",
col = hcl.colors(30, "YlOrRd"))
##calculate the 95th percentile for the baseline time period(30 years)
p95 <- quantile(wet_values_30yr, 0.95, na.rm = TRUE)
p95
##calculate the 99th percentile for the baseline time period(30 years)
p99<-quntile(wet_values_30yr,0.99,na.rm=TRUE)
##calculate the 99th percentile for the baseline time period(30 years)
p99<-quantile(wet_values_30yr,0.99,na.rm=TRUE)
p99
saveRDS(p99, "C:/Hydrology-Project/Rainfall Trend/scripts/p99_threshold.rds")
##read the 99th percentile value in the file
p99 <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/p99_threshold.rds")
print(p99)  # check value
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/R99p/"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
dates
r
dates
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
dates
dates
r<-rast(url) ##convert raster object
r
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
pts
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
rain_values
##read the 99th percentile value in the file
p99 <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/p99_threshold.rds")
print(p99)  # check value
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/R99p/"
r<-rast(url) ##convert raster object
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
##define the customize function
R99p<-function(daily_precip,threshold){
wet<-sum(daily_precip[as.numeric(daily_precip)>threshold])
return(wet)
}
##Apply above function for each station
extreme_wet_days<-apply(rain_values,1,R99p,threshold=p99)
extreme_wet_days
print(p99)  # check value
pts$R99p<-extreme_wet_days
##rasterize output
R99p_raster<-rasterize(pts,r[[1]],field="R99p")
## Save raster
file_name <- paste0(save_url, "R99p_1951.tif")
writeRaster(R99p_raster, file_name, overwrite = TRUE)
cat("Saved:", file_name, "\n")
##plot raster file
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
tif.files
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters<-rast(rasters)
rasters
# Plot with scientific color scale
plot(rasters,
main = "R99p for 1951",
col = hcl.colors(30, "YlOrRd"))
##read the 95th percentile value in the file
p95 <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/p95_threshold.rds")
print(p95)  # check value
##R95  indices
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/R95/"
r<-rast(url) ##convert raster object
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
##define the customize function
R95p<-function(daily_precip,threshold){
wet<-sum(daily_precip[as.numeric(daily_precip)>threshold])
return(wet)
}
##Apply above function for each station
very_wet_days<-apply(rain_values,1,R95,threshold=p95)
pts$R95p<-very_wet_days
##rasterize output
R95p_raster<-rasterize(pts,r[[1]],field="R95p")
## Save raster
file_name <- paste0(save_url, "R95p_1951.tif")
writeRaster(R95p_raster, file_name, overwrite = TRUE)
##read the 95th percentile value in the file
p95 <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/p95_threshold.rds")
print(p95)  # check value
##R95  indices
##import required libraries
library(terra)
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/R95/"
r<-rast(url) ##convert raster object
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
##define the customize function
R95p<-function(daily_precip,threshold){
wet<-sum(daily_precip[as.numeric(daily_precip)>threshold])
return(wet)
}
##Apply above function for each station
very_wet_days<-apply(rain_values,1,R95,threshold=p95)
pts$R95p<-very_wet_days
##rasterize output
R95p_raster<-rasterize(pts,r[[1]],field="R95p")
## Save raster
file_name <- paste0(save_url, "R95p_1951.tif")
writeRaster(R95p_raster, file_name, overwrite = TRUE)
cat("Saved:", file_name, "\n")
##plot raster file
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters<-rast(rasters)
rasters
# Plot with scientific color scale
plot(rasters,
main = "R95p for 1951",
col = hcl.colors(30, "YlOrRd"))
##import required libraries
library(terra)
library(zoo)
##define threshold value
threshold<-1
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##import required libraries
library(terra)
library(zoo)
##define threshold value
threshold<-1
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/annual_PRCPTOT/"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
dates
r
r[[1]]
as.Date(time(r))
dates<-dates <- as.Date(time(r), origin = "1951-01-01") ##time range 1951-01-01 to 1951-12-31
dates
dates <- as.Date(time(r), origin = "1951-01-01") ##time range 1951-01-01 to 1951-12-31
dates
r<-rast(url) ##convert raster object
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
rain_values
View(rain_values)
##define threshold value
threshold<-1
## Annual PRCPTOT indices
##import required libraries
library(terra)
library(zoo)
##Total Precipitation per Month Jan-DEC Locations 357
##define threshold value
wet_threshold<-1
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/annual_PRCPTOT/"
r<-rast(url) ##convert raster object
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
annual_PRCPTOT<-function(precip_vale,threshold){
wet_days<-sum(precip_vale[precip_vale>=threshold])
return(wet_days)
}
annual_wet_days<-apply(rain_values,1,annual_PRCPTOT,threshold=wet_threshold)
annual_wet_days
pts$annual_PRCPTOT<-annual_wet_days
##rasterize output
CWD_raster<-rasterize(pts,r[[1]],field="annual_PRCPTOT")
## Save raster
file_name <- paste0(save_url, "CWD_1951.tif")
## Annual PRCPTOT indices
##import required libraries
library(terra)
library(zoo)
##Total Precipitation per Month Jan-DEC Locations 357
##define threshold value
wet_threshold<-1
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/annual_PRCPTOT/"
r<-rast(url) ##convert raster object
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
annual_PRCPTOT<-function(precip_vale,threshold){
wet_days<-sum(precip_vale[precip_vale>=threshold])
return(wet_days)
}
annual_wet_days<-apply(rain_values,1,annual_PRCPTOT,threshold=wet_threshold)
pts$annual_PRCPTOT<-annual_wet_days
##rasterize output
annual_PRCPTOT_raster<-rasterize(pts,r[[1]],field="annual_PRCPTOT")
## Save raster
file_name <- paste0(save_url, "PRCPTOT_1951.tif")
writeRaster(annual_PRCPTOT_raster, file_name, overwrite = TRUE)
cat("Saved:", file_name, "\n")
very_wet_days
annual_wet_days
annual_wet_days
# Save to files
saveRDS(very_wet_days, "C:/Hydrology-Project/Rainfall Trend/scripts/R95_threshold.rds")
# Save to files
saveRDS(annual_wet_days, "C:/Hydrology-Project/Rainfall Trend/scripts/annual_PRCPTOT.rds")
##read the annual PRCPTOT percentile value in the file
annual_PRCPTOT <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/annual_PRCPTOT.rds")
print(annual_PRCPTOT)
##read the R95p value in the file
R95p <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/R95_threshold.rds")
print(R95p)
##calculate the indices
R95pTOT<-(100*R95p)/annual_PRCPTOT
R95p_raster
R95pTOT
##read the annual PRCPTOT percentile value in the file
annual_PRCPTOT <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/annual_PRCPTOT.rds")
##read the R95p value in the file
R95p <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/R95_threshold.rds")
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
pts
library(terra)
library(terra)
##read the annual PRCPTOT percentile value in the file
annual_PRCPTOT <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/annual_PRCPTOT.rds")
##read the R95p value in the file
R95p <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/R95_threshold.rds")
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
r<-rast(url) ##convert raster object
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##check the values
print(annual_PRCPTOT)
print(R95p)
##calculate the indices
R95pTOT<-(100*R95p)/annual_PRCPTOT
pts$R95pTOT<-R95pTOT
pts$R95pTOT<-R95pTOT
##rasterize output
R95pTOT_raster<-rasterize(pts,r[[1]],field="R95pTOT")
library(terra)
##read the annual PRCPTOT percentile value in the file
annual_PRCPTOT <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/annual_PRCPTOT.rds")
##read the R95p value in the file
R95p <- readRDS("C:/Hydrology-Project/Rainfall Trend/scripts/R95_threshold.rds")
##path of the nc file
url<-"C:/Hydrology-Project/Rainfall Trend/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/Hydrology-Project/Rainfall Trend/CSV files/drf_1951_new2.csv"
##save output url
save_url<-"C:/Hydrology-Project/Rainfall Trend/indices/R95pTOT/"
r<-rast(url) ##convert raster object
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##calculate the indices
R95pTOT<-(100*R95p)/annual_PRCPTOT
pts$R95pTOT<-R95pTOT
##rasterize output
R95pTOT_raster<-rasterize(pts,r[[1]],field="R95pTOT")
## Save raster
file_name <- paste0(save_url, "R95pTOT_1951.tif")
writeRaster(R95pTOT_raster, file_name, overwrite = TRUE)
cat("Saved:", file_name, "\n")
##plot raster file
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
tif.files
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters<-rast(rasters)
# Plot with scientific color scale
plot(rasters,
main = "R95pTOT â€“ 1951",
col = hcl.colors(30, "YlOrRd"))
