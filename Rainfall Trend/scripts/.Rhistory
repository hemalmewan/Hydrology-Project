roll_sum <- apply(vals_mat, 1, function(x) rollapply(x, width = d, FUN = sum, align = "left", na.rm = TRUE))
roll_sum <- as.matrix(roll_sum)
monthly_Rxdday <- apply(roll_sum, 2, max, na.rm = TRUE)
}else{
monthly_Rxdday <- rep(NA, nrow(vals))
}
##Attach the result as points
pts$Rxdday<-monthly_Rxdday
##create the raster layers
templete<-monthly_precipitation[[1]]
Rxdday_raster<-rasterize(pts,templete,field="Rxdday")
##Save raster
file_name<-paste0(save_url,"Rx",d,"day_1951_",sprintf("%02d",month),".tif")
writeRaster(Rxdday_raster,file_name,overwrite=TRUE)
}
##import reuqired libraries
library(terra)
library(zoo)
##get the user input
paste("Enter the Required d value:",d<-as.integer(readline()))
##import reuqired libraries
library(terra)
library(zoo)
##get the user input
paste("Enter the Required d value:",d<-as.integer(readline()))
print(d)
##validate the range of the d value it should be between 1 to 10
if(d<1 | d>10){
print("Error!!,d must be between 1 and 10")
}
##path of the nc file
url<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/drf_1951_new2.csv"
##save output url
save_url<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/Rxdday_1951"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##loop through all the months January to December
for (month in 1:12) {
##define end date and start date for each month
monthly_index<-which(format(dates,"%m")==sprintf("%02d",month))
##Daily precipitation data for each month
monthly_precipitation<-r[[monthly_index]]
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
vals_mat<-as.matrix(vals[,-1,drop=FALSE]) ##remove ID column
## Compute the rolling window days
if(ncol(vals_mat) >= d){
roll_sum <- apply(vals_mat, 1, function(x) rollapply(x, width = d, FUN = sum, align = "left", na.rm = TRUE))
roll_sum <- as.matrix(roll_sum)
monthly_Rxdday <- apply(roll_sum, 2, max, na.rm = TRUE)
}else{
monthly_Rxdday <- rep(NA, nrow(vals))
}
##Attach the result as points
pts$Rxdday<-monthly_Rxdday
##create the raster layers
templete<-monthly_precipitation[[1]]
Rxdday_raster<-rasterize(pts,templete,field="Rxdday")
##Save raster
file_name<-paste0(save_url,"Rx",d,"day_1951_",sprintf("%02d",month),".tif")
writeRaster(Rxdday_raster,file_name,overwrite=TRUE)
}
##define end date and start date for each month
monthly_index<-which(format(dates,"%m")==sprintf("%02d",month))
##Daily precipitation data for each month
monthly_precipitation<-r[[monthly_index]]
monthly_precipitation
##import reuqired libraries
library(terra)
library(zoo)
##get the user input
paste("Enter the Required d value:",d<-as.integer(readline()))
print(d)
##validate the range of the d value it should be between 1 to 10
if(d<1 | d>10){
print("Error!!,d must be between 1 and 10")
}
##path of the nc file
url<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/drf_1951_new2.csv"
##save output url
save_url<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/Rxdday_1951/"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
##loop through all the months January to December
for (month in 1:12) {
##define end date and start date for each month
monthly_index<-which(format(dates,"%m")==sprintf("%02d",month))
##Daily precipitation data for each month
monthly_precipitation<-r[[monthly_index]]
##Daily precipitation data in each month each location
vals<-extract(monthly_precipitation,pts)
vals_mat<-as.matrix(vals[,-1,drop=FALSE]) ##remove ID column
## Compute the rolling window days
if(ncol(vals_mat) >= d){
roll_sum <- apply(vals_mat, 1, function(x) rollapply(x, width = d, FUN = sum, align = "left", na.rm = TRUE))
roll_sum <- as.matrix(roll_sum)
monthly_Rxdday <- apply(roll_sum, 2, max, na.rm = TRUE)
}else{
monthly_Rxdday <- rep(NA, nrow(vals))
}
##Attach the result as points
pts$Rxdday<-monthly_Rxdday
##create the raster layers
templete<-monthly_precipitation[[1]]
Rxdday_raster<-rasterize(pts,templete,field="Rxdday")
##Save raster
file_name<-paste0(save_url,"Rx",d,"day_1951_",sprintf("%02d",month),".tif")
writeRaster(Rxdday_raster,file_name,overwrite=TRUE)
}
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
# Extract month number from file names
months <- as.numeric(gsub(".*_(\\d+)\\.tif$", "\\1", basename(tif.files)))
# Order files by month number
tif.files <- tif.files[order(months)]
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters
##set the grid size as 4 rows and 3 columns
par(mfrow=c(4,3))
month_names=month.abb
for (month in 1:12) {
plot(rasters[[month]], main = paste("Rx3day 1951 -", month_names[month]))
}
library(ggplot2)
library(tidyterra)  # for working with terra objects in ggplot2
install.packages("tidyterra")
library(viridis)   # for color palettes
# Set consistent color scale across all months
val_range <- range(values(rasters), na.rm = TRUE)
# Set plotting layout and margins
par(mfrow = c(4, 3),
mar = c(2, 2, 3, 2),   # inner plot margins
oma = c(0, 0, 4, 0))   # outer margins for title
month_names <- month.abb
for (i in 1:12) {
plot(
rasters[[i]],
main = paste("Rx3day (1951) -", month_names[i]),
col = viridis(30),
zlim = val_range,
axes = FALSE,
box = FALSE
)
}
rasters
# Set consistent color scale across all months
val_range <- range(values(rasters), na.rm = TRUE)
class(rasters)
rasters<-rast(rasters)
library(viridis)   # for color palettes
# Set consistent color scale across all months
val_range <- range(values(rasters), na.rm = TRUE)
# Set plotting layout and margins
par(mfrow = c(4, 3),
mar = c(2, 2, 3, 2),   # inner plot margins
oma = c(0, 0, 4, 0))   # outer margins for title
val_range
rasters
# Set plotting layout and margins
par(mfrow = c(4, 3),
mar = c(2, 2, 3, 2),   # inner plot margins
oma = c(0, 0, 4, 0))   # outer margins for title
month_names <- month.abb
for (i in 1:12) {
plot(
rasters[[i]],
main = paste("Rx3day (1951) -", month_names[i]),
col = viridis(30),
zlim = val_range,
axes = FALSE,
box = FALSE
)
}
# Add main title across the entire set
mtext("Monthly Maximum 3-Day Rainfall (Rx3day) — Year 1951",
outer = TRUE, cex = 1.5, font = 2)
install.packages("tmap")
library(viridis)   # for color palettes
library(tmap)
palette <- viridis(30)
tmap_style("natural")  # clean and professional theme
tm <- tm_shape(rasters) +
tm_raster(palette = palette,
title = "Rx3day (mm)",
legend.format = list(text.separator = " to ")) +
tm_facets(ncol = 3, nrow = 4, free.scales = FALSE) +
tm_layout(main.title = "Monthly Maximum 3-Day Rainfall (Rx3day) — 1951",
main.title.size = 1.5,
frame = FALSE,
legend.position = c("right","bottom"))
tm
rasters<-rast(rasters)
names(rasters)
names(rasters)<-month.abb
rasters
tmap_mode("plot")   # static plotting mode
tm <- tm_shape(rasters) +
tm_raster(
col = tm_scale(values = viridis(30)),      # color scale
col.legend = tm_legend(title = "Rx3day (mm)")
) +
tm_facets(ncol = 3, nrow = 4) +               # facet layout
tm_borders(lwd = 0.4) +                       # optional border
tm_title("Monthly Maximum 3-Day Rainfall (Rx3day) — 1951") +
tm_layout(frame = FALSE)
tm
rasters<-rast(rasters)
library(viridis)   # for color palettes
palette <- viridis(30)
# Set plotting layout and margins
par(mfrow = c(4, 3),
mar = c(2, 2, 3, 2),   # inner plot margins
oma = c(0, 0, 4, 0))   # outer margins for title
month_names <- month.abb
for (i in 1:12) {
plot(
rasters[[i]],
main = paste("Rx3day (1951) -", month_names[i]),
col = viridis(30),
zlim = val_range,
axes = FALSE,
box = FALSE
)
}
library(terra)
library(viridis)
val_range <- range(values(rasters), na.rm = TRUE)
par(mfrow = c(4, 3),
mar = c(2, 2, 3, 2),
oma = c(0, 0, 4, 0))
month_names <- month.abb
for (i in 1:12) {
plot(rasters[[i]], col = viridis(30), zlim = val_range,
main = paste("Rx3day (1951) -", month_names[i]),
axes = FALSE, box = FALSE)
}
mtext("Monthly Maximum 3-Day Rainfall (Rx3day) — Year 1951",
outer = TRUE, cex = 1.5, font = 2)
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters
rasters<-rast(rasters)
library(terra)
library(viridis)
val_range <- range(values(rasters), na.rm = TRUE)
par(mfrow = c(4, 3),
mar = c(2, 2, 3, 2),
oma = c(0, 0, 4, 0))
month_names <- month.abb
for (i in 1:12) {
plot(rasters[[i]], col = viridis(30), zlim = val_range,
main = paste("Rx3day (1951) -", month_names[i]),
axes = FALSE, box = FALSE)
}
mtext("Monthly Maximum 3-Day Rainfall (Rx3day) — Year 1951",
outer = TRUE, cex = 1.5, font = 2)
d
library(terra)
library(viridis)
val_range <- range(values(rasters), na.rm = TRUE)
par(mfrow = c(4, 3),
mar = c(2, 2, 3, 2),
oma = c(0, 0, 4, 0))
month_names <- month.abb
for (i in 1:12) {
plot(rasters[[i]], col = viridis(30), zlim = val_range,
main = paste("Rx1day (1951) -", month_names[i]),
axes = FALSE, box = FALSE)
}
mtext("Monthly Maximum 3-Day Rainfall (Rx3day) — Year 1951",
outer = TRUE, cex = 1.5, font = 2)
mtext("Monthly Maximum 1-Day Rainfall (Rx1day) — Year 1951",
outer = TRUE, cex = 1.5, font = 2)
for (i in 1:12) {
plot(rasters[[i]], col = viridis(30), zlim = val_range,
main = paste("Rx1day (1951) -", month_names[i]),
axes = FALSE, box = FALSE)
}
mtext("Monthly Maximum 1-Day Rainfall (Rx1day) — Year 1951",
outer = TRUE, cex = 1.5, font = 2)
##import required libraries
library(terra)
library(zoo)
##define threshold value
threshold<-1
##path of the nc file
url<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/drf_1951_new2.csv"
##save output url
save_url<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/PRCPTOT_1951/"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
## Loop for each month (1 to 12)
for(month in 1:12){
## Identify daily bands for this month
monthly_index <- which(format(dates, "%m") == sprintf("%02d", month))
monthly_precipitation <- r[[monthly_index]]
## Extract precipitation at stations
vals <- extract(monthly_precipitation, pts)
vals <- vals[,-1, drop = FALSE]  # remove ID column, keep matrix
## Compute PRCPTOT per station
PRCPTOT <- apply(vals, 1, function(x) sum(x[x >= threshold], na.rm = TRUE))
## Attach to points
pts$PRCPTOT <- PRCPTOT
## Rasterize output
template <- monthly_precipitation[[1]]
PRCPTOT_raster <- rasterize(pts, template, field = "PRCPTOT")
## Save raster
file_name <- paste0(save_url, "_PRCPTOT_1951_", sprintf("%02d", month), ".tif")
writeRaster(PRCPTOT_raster, file_name, overwrite = TRUE)
cat("Saved:", file_name, "\n")
}
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
# Extract month number from file names
months <- as.numeric(gsub(".*_(\\d+)\\.tif$", "\\1", basename(tif.files)))
# Order files by month number
tif.files <- tif.files[order(months)]
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters
##set the grid size as 4 rows and 3 columns
par(mfrow=c(4,3))
month_names=month.abb
par(mfrow=c(1,1))
##set the grid size as 4 rows and 3 columns
par(mfrow=c(4,3))
month_names=month.abb
for (month in 1:12) {
plot(rasters[[month]], main = paste("PRCPTOT 1951 -", month_names[month]))
}
##import reauired libraries
library(terra)
##path of the nc file
url<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/drf_1951_new2.csv"
##save output url
save_url<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/PRCPTOT_1951/"
r<-rast(url) ##convert raster object
r
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
dates
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
pts
r[[1]]
# Define threshold for dry day
dry_threshold <- 1  # mm
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
rain_values
View(rain_values)
##Remove ID column
rain_values<-rain_values[,-1]
rain_values
rain_values[1,]
rain_values[1,]<dry_threshold
?rle
rle(rain_values[1,]<dry_threshold)
dry<-rain_values[1,]<dry_threshold
rle(dry)
rle(dry)
as.numeric(rain_values[,1])<dry_threshold
rle(as.numeric(rain_values[,1])<dry_threshold)
dry<-as.numeric(rain_values[,1])<dry_threshold
dry
rle_dry<-rle(dry)
rle_dry$lengths
rle_dry$values
dry<-as.numeric(rain_values[1,])<dry_threshold
rle_dry<-rle(dry)
rle_dry$lengths
dry
max(rle_dry$lengths[rle_dry$values])
##define the customize function
CDD<-function(daily_precip,threshold=1){
dry<-daily_precip<threshold
if(!all(dry)) return(0) ##no dry days
rle_dry<-rle(dry)
max_cdd<-max(rle_dry$lengths[rle_dry$values])
return(max_cdd)
}
##Apply above function for each station
cdd_values<-apply(rain_values,1,CDD,threshold=dry_threshold)
cdd_values
##define the customize function
CDD<-function(daily_precip,threshold=1){
dry<-as.numeric(daily_precip)<threshold
if(!all(dry)) return(0) ##no dry days
rle_dry<-rle(dry)
max_cdd<-max(rle_dry$lengths[rle_dry$values])
return(max_cdd)
}
##Apply above function for each station
cdd_values<-apply(rain_values,1,CDD,threshold=dry_threshold)
cdd_values
##define the customize function
CDD<-function(daily_precip,threshold=1){
dry<-as.numeric(daily_precip)<threshold
if(all(!dry)) return(0) ##no dry days
rle_dry<-rle(dry)
max_cdd<-max(rle_dry$lengths[rle_dry$values])
return(max_cdd)
}
##Apply above function for each station
cdd_values<-apply(rain_values,1,CDD,threshold=dry_threshold)
cdd_values
pts$CDD<-cdd_values
pts
r
r[[1]]
##rasterize
rasterize(pts,r[[1]],field="CDD")
min(cdd_values)
max(cdd_values)
##import required libraries
library(terra)
##path of the nc file
url<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/NCDF/rainfall_1951_daily.nc"
##path of the csv file
url_1<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/drf_1951_new2.csv"
##save output url
save_url<-"C:/UOC pdf/4th Year/DS 4007-Research/sptiao_tempo/Hydrology-Project/Rainfall Input/CDD/"
r<-rast(url) ##convert raster object
dates<-as.Date(time(r)) ##time range 1951-01-01 to 1951-12-31
points<-read.csv(url_1) ##read csv file
pts<-vect(points,geom=c("lon","lat"),crs=crs(r)) ##convert the lat lon as the spatial locations
# Define threshold for dry day
dry_threshold <- 1  # mm
##Extract daily rainfall at point
rain_values<-terra::extract(r,pts)
##Remove ID column
rain_values<-rain_values[,-1]
##define the customize function
CDD<-function(daily_precip,threshold=1){
dry<-as.numeric(daily_precip)<threshold
if(all(!dry)) return(0) ##no dry days
rle_dry<-rle(dry)
max_cdd<-max(rle_dry$lengths[rle_dry$values])
return(max_cdd)
}
##Apply above function for each station
cdd_values<-apply(rain_values,1,CDD,threshold=dry_threshold)
pts$CDD<-cdd_values
##rasterize output
CDD_raster<-rasterize(pts,r[[1]],field="CDD")
## Save raster
file_name <- paste0(save_url, "CDD_1951.tif")
writeRaster(CDD_raster, file_name, overwrite = TRUE)
cat("Saved:", file_name, "\n")
r[[1]]
tif.files<-list.files(save_url,pattern = "\\.tif$",full.names = TRUE)
tif.files
# Extract month number from file names
months <- as.numeric(gsub(".*_(\\d+)\\.tif$", "\\1", basename(tif.files)))
months
# Order files by month number
tif.files <- tif.files[order(months)]
##Load them as a SpatRaster files
rasters<-lapply(tif.files,rast)
rasters
##set the grid size as 4 rows and 3 columns
par(mfrow=c(4,3))
month_names=month.abb
for (month in 1:12) {
plot(rasters[[month]], main = paste("PRCPTOT 1951 -", month_names[month]))
}
par(mfrow=c(1,1))
plot(rasters, main ="CDD 1951")
rasters
rasters<-rast(rasters)
plot(rasters, main ="CDD 1951")
# Plot with scientific color scale
plot(rasters,
main = "Consecutive Dry Days (CDD) – 1951",
col = hcl.colors(30, "YlOrRd"))
par(mfrow=c(1,1))
# Plot with scientific color scale
plot(rasters,
main = "Consecutive Dry Days (CDD) – 1951",
col = hcl.colors(30, "YlOrRd"))
# Plot with scientific color scale
plot(rasters,
main = "Consecutive Dry Days (CDD) – 1951",
col = hcl.colors(30, "YlOrRd"))
# Plot with scientific color scale
plot(rasters,
main = "Consecutive Dry Days (CDD) – 1951")
par(mfrow=c(1,1))
# Plot with scientific color scale
plot(rasters,
main = "Consecutive Dry Days (CDD) – 1951")
# Plot with scientific color scale
plot(rasters,
main = "Consecutive Dry Days (CDD) – 1951",
col = hcl.colors(30, "YlOrRd"))
par(mfrow=c(1,1))
# Plot with scientific color scale
plot(rasters,
main = "Consecutive Dry Days (CDD) – 1951",
col = hcl.colors(30, "YlOrRd"))
